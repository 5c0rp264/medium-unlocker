{"version":3,"file":"background.js","sources":["../src/constants.js","../src/utils.js","../src/background.js"],"sourcesContent":["/**\n * File: constants.js\n * Project: svelte-app\n * File Created: 22 Dec 2021 14:22:09\n * Author: und3fined (me@und3fined.com)\n * -----\n * Last Modified: 31 Dec 2021 19:42:41\n * Modified By: und3fined (me@und3fined.com)\n * -----\n * Copyright (c) 2021 und3fined.com\n */\nexports.operationName = {\n  cookieStatus: 'PostMeter',\n  postContent: 'PostViewerEdgeContentQuery'\n};\n\nexports.operationSelector = {\n  cookieStatus: 'data.meterPost.unlocksRemaining'\n}\n\nexports.memberShipId = 'paywall-fewerClicksHeading';\nexports.registerWall = 'regwall-heading';\n\nexports.domainList = [\n  \"https://medium.com/*\",\n  \"https://*.medium.com/*\",\n  \"https://towardsdatascience.com/*\",\n  \"https://hackernoon.com/*\",\n  \"https://medium.freecodecamp.org/*\",\n  \"https://psiloveyou.xyz/*\",\n  \"https://betterhumans.coach.me/*\",\n  \"https://codeburst.io/*\",\n  \"https://theascent.pub/*\",\n  \"https://medium.mybridge.co/*\",\n  \"https://uxdesign.cc/*\",\n  \"https://levelup.gitconnected.com/*\",\n  \"https://itnext.io/*\",\n  \"https://entrepreneurshandbook.co/*\",\n  \"https://proandroiddev.com/*\",\n  \"https://blog.prototypr.io/*\",\n  \"https://thebolditalic.com/*\",\n  \"https://blog.usejournal.com/*\",\n  \"https://blog.angularindepth.com/*\",\n  \"https://blog.bitsrc.io/*\",\n  \"https://blog.devartis.com/*\",\n  \"https://blog.maddevs.io/*\",\n  \"https://blog.getambassador.io/*\",\n  \"https://uxplanet.org/*\",\n  \"https://instagram-engineering.com/*\",\n  \"https://calia.me/*\",\n  \"https://productcoalition.com/*\",\n  \"https://engineering.opsgenie.com/*\",\n  \"https://android.jlelse.eu/*\",\n  \"https://robinhood.engineering/*\",\n  \"https://blog.hipolabs.com/*\",\n  \"https://ux.shopify.com/*\",\n  \"https://enlear.academy/*\",\n];\n","/**\n * File: utils.js\n * Project: medium-unlocker\n * File Created: 23 Dec 2021 11:12:59\n * Author: und3fined (me@und3fined.com)\n * -----\n * Last Modified: 31 Dec 2021 21:10:11\n * Modified By: und3fined (me@und3fined.com)\n * -----\n * Copyright (c) 2021 und3fined.com\n */\nconst uIdPattern = '0123456789abcdef';\nconst sIdPattern = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789._/';\n\nfunction generateId(length, characters) {\n  let result = '';\n  let charsLen = characters.length;\n  for (let i = 0; i < length; i++) {\n    result += characters.charAt(Math.floor(Math.random() * charsLen));\n  }\n\n  return result;\n}\n\nexports.generateUID = () => {\n  return `lo_${generateId(12, uIdPattern)}`;\n}\n\nexports.generateSID = () => {\n  return `1:${generateId(64, sIdPattern)}`\n}\n\nexports.getBeforeSendExtraInfoSpec = () => {\n  const extraInfoSpec = [\"blocking\", \"requestHeaders\"];\n  if (\n    chrome.webRequest.OnBeforeSendHeadersOptions.hasOwnProperty(\"EXTRA_HEADERS\")\n  ) {\n    extraInfoSpec.push(\"extraHeaders\");\n  }\n  return extraInfoSpec;\n}\n\nexports.getHeaders = (headers, headerName, condition) => {\n  return headers.filter(({ name }) => condition(name.toLowerCase(), headerName));\n}\n\nexports.hasElm = (elm) => {\n  return !!document.getElementById(elm);\n}","/**\n * File: background.js\n * Project: svelte-app\n * File Created: 22 Dec 2021 14:17:58\n * Author: und3fined (me@und3fined.com)\n * -----\n * Last Modified: 31 Dec 2021 21:18:27\n * Modified By: und3fined (me@und3fined.com)\n * -----\n * Copyright (c) 2021 und3fined.com\n */\nconst { domainList } = require(\"./constants\");\nconst {\n  generateUID,\n  generateSID,\n  getBeforeSendExtraInfoSpec,\n  getHeaders\n} = require(\"./utils\");\n\nconst mediumGraphql = \"/_/graphql\";\nconst postDetailType = \"PostViewerEdgeContentQuery\";\n\nlet needPatch = [];\n\nfunction rewriteCookieHeader({ url, requestId, requestHeaders }) {\n  if (url.endsWith(mediumGraphql) === false) {\n    return { requestHeaders };\n  }\n\n  const operation = requestHeaders.filter(\n    ({ name }) => name.toLowerCase() === \"graphql-operation\"\n  );\n\n  if (\n    !operation.length ||\n    (operation.length && operation[0].value !== postDetailType)\n  ) {\n    return { requestHeaders };\n  }\n\n  needPatch.push(requestId);\n\n  let newHeaders = getHeaders(requestHeaders, \"cookie\", (a, b) => a !== b);\n  const cookieHeader = getHeaders(requestHeaders, \"cookie\", (a, b) => a === b);\n\n  if (cookieHeader.length === 1) {\n    const uid = generateUID();\n    const sid = generateSID();\n\n    let newCookie = decodeURIComponent(cookieHeader[0].value);\n    newCookie = newCookie.replace(/uid=(\\w+);/, `uid=${uid};`);\n    newCookie = newCookie.replace(/sid=(.{0,72});/, `sid=${encodeURIComponent(sid)};`);\n    newCookie = newCookie.replace(/optimizelyEndUserId=(\\w+);/, `optimizelyEndUserId=${uid};`);\n    newHeaders.push({ name: \"cookie\", value: newCookie });\n    return { requestHeaders: newHeaders };\n  }\n\n  return { requestHeaders };\n}\n\nfunction handleResponse({ requestId, responseHeaders }) {\n  if (needPatch.includes(requestId) === false) {\n    return { responseHeaders };\n  }\n\n  const newHeaders = getHeaders(responseHeaders, \"set-cookie\", (a, b) => a !== b);\n\n  return { responseHeaders: newHeaders };\n}\n\nfunction handleMessage({ request }, sender, sendResponse) {\n  if (request === \"fetch-cookie\") {\n    fetchCookie();\n  }\n\n  if (request === \"get-cookie\") {\n    sendResponse({ response: request, data: cookieTemp });\n  }\n}\n\nchrome.webRequest.onBeforeSendHeaders.addListener(\n  rewriteCookieHeader,\n  { urls: domainList },\n  getBeforeSendExtraInfoSpec()\n);\n\nchrome.webRequest.onHeadersReceived.addListener(\n  handleResponse,\n  { urls: domainList },\n  [\"blocking\", \"responseHeaders\"]\n);\n"],"names":["require$$0","require$$1"],"mappings":"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"}